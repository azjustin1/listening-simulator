<div class="test-container">
  <div class="question-group">
    <mat-accordion>
      @for (question of data.questions; track $index) {
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{ question.name }}
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="form-group question-name">
            @if (!isSaved && !isReadOnly && !isTesting) {
              @if (mapQuestionEditting[question.id!]) {
                <mat-form-field>
                  <mat-label>Question Name</mat-label>
                  <input
                    autocomplete="off"
                    matInput
                    name="questionName"
                    class="form-control"
                    id="questionName"
                    [(ngModel)]="question.name"
                    required
                  />
                </mat-form-field>
              } @else {
                <h3>{{ question.name }}</h3>
              }
              @if (!isSaved && !isReadOnly && !isTesting) {
                <div class="actions">
                  @if (mapQuestionEditting[question.id!]) {
                    <button
                      mat-button
                      color="primary"
                      type="button"
                      class="btn btn-danger"
                      (click)="onSaveQuestion(question.id!)"
                    >
                      <mat-icon>save</mat-icon>
                    </button>
                  } @else {
                    <button
                      mat-button
                      color="primary"
                      type="button"
                      class="btn btn-danger"
                      (click)="onEditQuestion(question.id!)"
                    >
                      <mat-icon>edit</mat-icon>
                    </button>
                  }
                  <button
                    mat-button
                    color="warn"
                    type="button"
                    class="btn btn-danger"
                    (click)="removeQuestion($index)"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              }
            }
          </div>
          @for (subQuestion of question.subQuestions; track $index) {
            <app-multiple-choices
              [question]="question"
              [isReadOnly]="isReadOnly"
              [isEditting]="mapQuestionEditting[question.id!]"
              [isTesting]="isTesting"
            ></app-multiple-choices>
          }
          @if (!isSaved && !isTesting && !isReadOnly) {
            <div class="add-question">
              <button
                mat-button
                type="button"
                class="btn btn-danger"
                (click)="addQuestion($index, true)"
              >
                <mat-icon>add</mat-icon> Add question
              </button>
            </div>
          }
        </mat-expansion-panel>
      }
    </mat-accordion>
    @if (!isSaved && !isTesting && !isReadOnly) {
      <div class="add-question">
        <button
          mat-button
          type="button"
          class="btn btn-danger"
          (click)="addQuestion(0, false)"
        >
          <mat-icon>add</mat-icon> Add question
        </button>
      </div>
    }
  </div>
  <div class="input-reading">
    @if (!isSaved && !isReadOnly && !isTesting) {
      <angular-editor
        name="questionContent"
        [id]="data.id"
        [(ngModel)]="data.content"
      ></angular-editor>
    } @else {
      <span [innerHTML]="data.content"></span>
    }
  </div>
</div>
