<div id="quiz-container" class="mt-3">
  @if (data) {
    <div class="form-group">
      @if (data.isMatchHeader) {
        <div class="d-flex w-100">
          <app-matching-header
            [data]="data"
            [answers]="answers()"
            [isSaved]="isSaved"
            [isReadOnly]="isReadOnly"
            [isTesting]="isTesting"
            [isEditing]="isEditing"
            [(selectedId)]="selectedId"
            (onAnswer)="onMatchHeaderAnswer.emit($event)"
          ></app-matching-header>
        </div>
      } @else {
        <div
          class="d-flex w-100"
          [ngClass]="{ 'un-clickable': isTesting && !isStart }"
        >
          <div class="col-6">
            @if (!isSaved && !isReadOnly && !isTesting) {
              <angular-editor
                class="editor"
                name="questionContent"
                [id]="data.id"
                [(ngModel)]="data.content"
                (ngModelChange)="onPaste($event)"
                [config]="config"
              ></angular-editor>
            } @else {
              @if (data) {
                <p textSelection class="reading-content"
                   [innerHTML]="data.content"></p>
              }
            }
          </div>
          <div class="question-container ms-3 flex-column">
            <div class="form-group mb-2">
              @if (isSaved || isTesting || isReadOnly) {
                <div [innerHTML]="data.name"></div>
              } @else {
                <angular-editor
                  autocomplete="off"
                  name="part"
                  type="text"
                  id="part"
                  [(ngModel)]="data.name"
                  [config]="config"
                  required
                ></angular-editor>
              }
            </div>
            @for (question of data.questions; track $index) {
              <div class="question flex-column">
                <app-question
                  [question]="question"
                  [isSaved]="isSaved"
                  [isEditing]="mapQuestionEditing[question.id]"
                  [isReadOnly]="isReadOnly"
                  [isTesting]="isTesting"
                  [isExpandable]="true"
                  [(selectedId)]="selectedId"
                  [(selectedQuestionIndex)]="selectedQuestionIndex"
                  (onSave)="onSaveClick()"
                  (onAnswer)="onPartAnswerQuestion.emit($event)"
                  (onAnswerChoice)="onPartAnswerChoice.emit($event)"
                ></app-question>
                <div class="actions mt-2">
                  @if (!isSaved && !isTesting && !isReadOnly) {
                    @if (mapQuestionEditing[question.id]) {
                      <button
                        mat-button
                        color="primary"
                        type="button"
                        (click)="onSaveQuestion(question.id)"
                      >
                        <mat-icon>save</mat-icon>
                      </button>
                    } @else {
                      <button
                        mat-button
                        color="primary"
                        type="button"
                        (click)="onEditQuestion(question.id)"
                      >
                        <mat-icon>edit</mat-icon>
                      </button>
                    }
                    <button
                      mat-button
                      type="button"
                      (click)="duplicateQuestion(question)"
                    >
                      <mat-icon>content_copy</mat-icon>
                    </button>
                    <button
                      mat-button
                      color="warn"
                      type="button"
                      (click)="removeQuestion($index)"
                    >
                      <mat-icon>delete</mat-icon>
                    </button>
                    @if ($index !== 0) {
                      <button
                        mat-button
                        type="button"
                        (click)="moveQuestionUp($index)"
                      >
                        <mat-icon>arrow_upward</mat-icon>
                      </button>
                    }
                    @if ($index !== data.questions.length - 1) {
                      <button
                        mat-button
                        type="button"
                        (click)="moveQuestionDown($index)"
                      >
                        <mat-icon>arrow_downward</mat-icon>
                      </button>
                    }
                  }
                </div>
              </div>
            }

            @if (!isSaved && !isTesting && !isReadOnly) {
              <div class="d-flex flex-row flex-wrap mt-2">
                <button
                  class="d-flex my-1"
                  mat-raised-button
                  (click)="addQuestion(questionType.MULTIPLE_CHOICE)"
                >
                  Multiple Choices
                </button>
                <!--          <button-->
                <!--            class="d-flex ms-1"-->
                <!--            mat-raised-button-->
                <!--            (click)="addQuestion(1)"-->
                <!--          >-->
                <!--            Short Answer-->
                <!--          </button>-->
                <button
                  class="d-flex my-1 ms-1"
                  mat-raised-button
                  (click)="addQuestion(questionType.DROPDOWN_ANSWER)"
                >
                  Dropdown Choices
                </button>
                <button
                  class="d-flex my-1 ms-1"
                  mat-raised-button
                  (click)="addQuestion(4)"
                >
                  Label On Map
                </button>
                <button
                  class="d-flex my-1 ms-1"
                  mat-raised-button
                  (click)="addQuestion(questionType.FILL_IN_THE_GAP)"
                >
                  Fill In The Gap
                </button>

                <button
                  class="d-flex my-1 ms-1"
                  mat-raised-button
                  (click)="addQuestion(questionType.DRAG_AND_DROP_ANSWER)"
                >
                  Drag And Drop
                </button>
                <button
                  class="d-flex my-1 ms-1"
                  mat-raised-button
                  (click)="addQuestion(questionType.FILL_IN_THE_TABLE)"
                >
                  Fill In The Table
                </button>
                <button
                  class="d-flex my-1 ms-1"
                  mat-raised-button
                  (click)="addQuestion(questionType.DRAG_IN_TABLE)"
                >
                  Drag In The Table
                </button>
              </div>
            }
          </div>
        </div>
      }
    </div>
  }
</div>
